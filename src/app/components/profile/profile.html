@if (user()) {
  <section class="profile">
    <div class="profile__header">
      <h1 class="profile__title">My Profile</h1>
      <p class="profile__subtitle">Manage your account settings and preferences</p>
    </div>

    <div class="profile__stats">
      <div class="stat-card">
        <div class="stat-icon">â¤ï¸</div>
        <div class="stat-content">
          <div class="stat-value">{{ favoritesCount() }}</div>
          <div class="stat-label">Favorites</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“¦</div>
        <div class="stat-content">
          <div class="stat-value">Active</div>
          <div class="stat-label">Account Status</div>
        </div>
      </div>
    </div>

    <div class="profile__card">
      <div class="profile__avatar-section">
        <div class="profile__avatar-wrapper">
          @if (profilePictureUrl()) {
            <img [src]="profilePictureUrl()!" [alt]="user()?.email || 'Profile'" class="profile__avatar-img" />
          } @else {
            <div class="profile__avatar">
              {{ user()?.email?.charAt(0) | uppercase }}
            </div>
          }
          <button 
            type="button" 
            class="profile__avatar-upload"
            (click)="triggerFileInput()"
            [disabled]="uploading()"
            [attr.aria-label]="'Upload profile picture'"
            title="Change profile picture"
          >
            @if (uploading()) {
              <span class="upload-spinner"></span>
            } @else {
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
              </svg>
            }
          </button>
          <input 
            #fileInput
            type="file" 
            accept="image/jpeg,image/jpg,image/png"
            (change)="onFileSelected($event)"
            style="display: none;"
          />
        </div>
        <div class="profile__avatar-info">
          <h2 class="profile__name">{{ (user()?.email?.split('@') || [])[0] || 'User' }}</h2>
          <p class="profile__email">{{ user()?.email }}</p>
        </div>
      </div>

      <div class="profile__divider"></div>

      <div class="profile__info">
        <h3 class="profile__section-title">Account Information</h3>
        
        <div class="profile__info-grid">
          <div class="info-item">
            <div class="info-icon">ğŸ“§</div>
            <div class="info-content">
              <div class="info-label">Email Address</div>
              <div class="info-value">{{ user()?.email }}</div>
            </div>
          </div>

          <div class="info-item">
            <div class="info-icon">ğŸ†”</div>
            <div class="info-content">
              <div class="info-label">User ID</div>
              <div class="info-value info-value--code">{{ user()?.uid }}</div>
            </div>
          </div>

          @if (accountCreatedDate) {
            <div class="info-item">
              <div class="info-icon">ğŸ“…</div>
              <div class="info-content">
                <div class="info-label">Member Since</div>
                <div class="info-value">{{ accountCreatedDate }}</div>
              </div>
            </div>
          }

          @if (lastSignInDate) {
            <div class="info-item">
              <div class="info-icon">ğŸ•</div>
              <div class="info-content">
                <div class="info-label">Last Sign In</div>
                <div class="info-value">{{ lastSignInDate }}</div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>

    <div class="profile__quick-actions">
      <a routerLink="/favorites" class="quick-action-btn">
        <span class="quick-action-icon">â¤ï¸</span>
        <span>View Favorites</span>
        <span class="quick-action-badge" *ngIf="favoritesCount() > 0">{{ favoritesCount() }}</span>
      </a>
      <a routerLink="/items" class="quick-action-btn">
        <span class="quick-action-icon">ğŸ”</span>
        <span>Browse Items</span>
      </a>
    </div>

    @if (error()) {
      <div class="profile__error">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        {{ error() }}
      </div>
    }

    <div class="profile__actions">
      <button type="button" class="logout-btn" (click)="logout()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16 17 21 12 16 7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        Sign Out
      </button>
    </div>
  </section>
} @else {
  <section class="profile">
    <div class="profile__loading">
      <div class="loading-spinner"></div>
      <p>Loading user profile...</p>
    </div>
  </section>
}
